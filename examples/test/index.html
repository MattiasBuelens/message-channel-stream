<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Message channel stream example</title>
    <script src="../../dist/message-channel-stream.js"></script>
</head>
<body>

<script>
  const { RemoteReadableStream } = MessageChannelStream;

  const worker = new Worker('./worker.js');
  const { readable, writablePort } = new RemoteReadableStream();
  worker.postMessage(writablePort, [writablePort]);

  (async () => {
    const reader = readable.getReader();
    for (let i = 0; true; i++) {
      if (i === 2) {
        console.log('reader cancel');
        reader.cancel('reader cancelled');
        break;
      }
      console.log('reader read');
      const { done, value } = await reader.read();
      if (done) {
        break;
      }
      console.log('reader got:', value);
    }
    console.log('reader done');
  })();
</script>

</body>
</html>
